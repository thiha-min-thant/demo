apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  creationTimestamp: null
  labels:
    infra_id: c5d5202f-d438-45e1-94e3-4d00343a71bb
    revision_id: bc701452-5a28-4aa2-8c01-dba74233f4d1
    subject: '{{workflow.parameters.appNamespace}}_kube-proxy'
    workflow_id: 607a7b32-70fe-437a-b372-3c39f7d70e81
    workflows.argoproj.io/controller-instanceid: c5d5202f-d438-45e1-94e3-4d00343a71bb
  name: from-dashboard
  namespace: litmus-infra
spec:
  arguments:
    parameters:
    - name: adminModeNamespace
      value: litmus-infra
    - name: appNamespace
      value: kube-system
  entrypoint: argowf-chaos
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
  serviceAccountName: argo-chaos
  templates:
  - inputs: {}
    metadata: {}
    name: argowf-chaos
    outputs: {}
    steps:
    - - arguments: {}
        name: run-chaos
        template: run-chaos
    - - arguments: {}
        name: cleanup-chaos-resources
        template: cleanup-chaos-resources
  - inputs:
      artifacts:
      - name: install-chaos-faults
        path: /tmp/pod-delete.yaml
    metadata: {}
    name: install-chaos-faults
    outputs: {}
  - container:
      args:
      - -file=/tmp/chaosengine-run-chaos.yaml
      - -saveName=/tmp/engine-name
      image: docker.io/litmuschaos/litmus-checker:2.11.0
      name: ""
      resources: {}
    inputs:
      artifacts:
      - name: run-chaos
        path: /tmp/chaosengine-run-chaos.yaml
        raw:
          data: |
            apiVersion: litmuschaos.io/v1alpha1
            kind: ChaosEngine
            metadata:
              namespace: "{{workflow.parameters.adminModeNamespace}}"
              labels:
                context: "{{workflow.parameters.appNamespace}}_kube-proxy"
                workflow_run_id: "{{ workflow.uid }}"
                workflow_name: from-dashboard
              annotations:
                probeRef: '[{"name":"demo-httpd","mode":"EOT"}]'
              generateName: run-chaos
            spec:
              appinfo:
                appns: kube-system
                applabel: k8s-app=kube-proxy
                appkind: daemonset
              jobCleanUpPolicy: retain
              engineState: active
              chaosServiceAccount: litmus-admin
              experiments:
                - name: pod-delete
                  spec:
                    components:
                      env:
                        - name: TOTAL_CHAOS_DURATION
                          value: "60"
                        - name: CHAOS_INTERVAL
                          value: "10"
                        - name: FORCE
                          value: "false"
    metadata:
      labels:
        weight: "10"
    name: run-chaos
    outputs: {}
  - container:
      args:
      - kubectl delete chaosengine -l workflow_run_id={{workflow.uid}} -n {{workflow.parameters.adminModeNamespace}}
      command:
      - sh
      - -c
      image: litmuschaos/k8s:latest
      name: ""
      resources: {}
    inputs: {}
    metadata: {}
    name: cleanup-chaos-resources
    outputs: {}
status:
  finishedAt: null
  startedAt: null
